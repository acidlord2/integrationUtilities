<?php
require_once($_SERVER['DOCUMENT_ROOT'] . '/config.php');
require_once($_SERVER['DOCUMENT_ROOT'] . '/classes/Sportmaster/Product-v1.php');
require_once($_SERVER['DOCUMENT_ROOT'] . '/classes/Common/Log.php');
require_once($_SERVER['DOCUMENT_ROOT'] . '/classes/MS/ProductsMS.php');

$clientId = SPORTMASTER_ULLO_CLIENT_ID;
$warehouseId = SPORTMASTER_ULLO_WAREHOUSE_ID;
$productClass = new \Classes\Sportmaster\v1\Product($clientId);
$stocks = $productClass->stockList($warehouseId);
// If you want to use MS Products class, uncomment the following lines
$msProductClass = new \Classes\MS\ProductsMS();
$assortment = $msProductClass->getAssortment(array_column($stocks, 'offerId'));
$postStock = array();
foreach ($stocks as $stock) {
    $product = array_filter($assortment, function($item) use ($stock) {
        return $item['code'] === $stock['offerId'];
    });
    if (!empty($product)) {
        $postStock[] = array(
            'offerId' => $product['code'],
            'warehouseStock' => $stock['quantity'],
        );
    } else {
        $postStock[] = array(
            'offerId' => $product['code'],
            'warehouseStock' => 0,
        );
    }
}
if ($productClass->stockImport($warehouseId, $postStock)) {
    echo len ($postStock) . ' stocks updated successfully';
} else {
    echo 'Failed to update stocks';
}